<?php

try {
	$login = $_SESSION['login'];

	// On teste si le visiteur a soumis le formulaire pour changer de mot de passe
	if (isset($_POST['modification_mdp']) && $_POST['modification_mdp'] == "Modifier") {
	
		include_once('modele/pwdChangerValidator.php');
		include_once('modele/modifie_mdp.php');
		
		// on teste l'existence de nos variables et si elles ne sont pas vide. On teste également si elles sont valides
		$validator_result = pwdChangerValidator($_POST);
		$salt = 'PeEa3B25$ANZQ_7PmFYMtJV#2FuS*DteaFZ4MézaMpXa-ZH2TucFG6';
	
		if ($validator_result[0]) {
			modifie_mdp($login, md5($_POST['pass_nouveau'].$salt.$login));
			echo ('<script>window.alert("Votre mot de passe à été mis à jour!")</script>');
		}
	}

	// On teste si le visiteur a soumis le formulaire pour changer son email
	else if (isset($_POST['modification_email']) && $_POST['modification_email'] == "Modifier") {
	
		include_once('modele/mailChangerValidator.php');
		include_once('modele/modifie_email.php');

		// on teste l'existence de nos variables et si elles ne sont pas vide. On teste également si elles sont valides
		$validator_result = mailChangerValidator($_POST);
	
		if ($validator_result[0]) {
			modifie_email($login, $_POST['mail']);
			echo ('<script>window.alert("Votre adresse e-mail à été mise à jour!")</script>');
			unset($_POST['mail']);
		}
	}
catch (Exception $e)
{
	die("Erreur : " . $e->getMessage() . "<br /><a href=index.php>Retour à la page d'accueil</a>");
}




// On charge la gestion du login
include_once('controleur/login_manager.php');

// On affiche la page (vue)
include_once('vue/parametres.php');
